
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Snowfall Retrievals CSU X-Band Radar March 14, 2022 &#8212; SAIL X-Band Radar Precipitation</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script async="async" kind="hypothesis" src="https://hypothes.is/embed.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Plot PPI data for BAMS Paper" href="plot-ams-figures.html" />
    <link rel="prev" title="Check Reflectivity Calibration" href="compare-with-kazr.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../_static/arm_logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">SAIL X-Band Radar Precipitation</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../overview.html">
                    Surface Atmosphere Integrated Field Laboratory (SAIL) Radar Analysis
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Looking at the Domain
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../domain-exploration/plot-sail-splash-sites.html">
   Plot the SAIL and SPLASH Locations
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Apply Quality Control/Assurance
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../gluing_and_inventory/concatinate_file.html">
   Gluing and Merging
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../qc/sail_beam_blockage.html">
   Beam Blockage for SAIL
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Dual-Pol Exploration
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../dual-pol/dual-pol-exploration.html">
   Explore Dual-Pol Data from SAIL
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../dual-pol/kdp-xradar-exploration.html">
   Investigate KDP and PhiDP through a Convective Core near SAIL
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Investigate Precipitation
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="compare-with-kazr.html">
   Check Reflectivity Calibration
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Snowfall Retrievals CSU X-Band Radar March 14, 2022
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="plot-ams-figures.html">
   Plot PPI data for BAMS Paper
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="plot-method-description-figure.html">
   Plot a Description of the Liquid Precip Estimation Method
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Value Added Products
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../VAP/cmac2_technical_document.html">
   Figures for the SAIL CMAC2.0 Technical Document
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../VAP/matched_dataset_march_14_2022.html">
   Extracted Radar Columns and In-Situ Sensors (RadCLss) Dataset
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../VAP/nearest-neighbor-interpolation.html">
   Grid QC’d Dataset - Surface QUantitatIve pRecipitation Estimation (SQUIRE)
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/ARM-Development/sail-xprecip-radar/main?urlpath=lab/tree/notebooks/radar-precip/csu-xband-snowfall-march-14-2022.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
      <li>
        <a href="https://jupyter-open.olcf.ornl.gov/hub/user-redirect/git-pull?repo=https%3A//github.com/ARM-Development/sail-xprecip-radar&urlpath=lab/tree/sail-xprecip-radar/notebooks/radar-precip/csu-xband-snowfall-march-14-2022.ipynb&branch=main"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on JupyterHub"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../_static/images/logo_jupyterhub.svg">
  </span>
<span class="headerbtn__text-container">JupyterHub</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../_sources/radar-precip/csu-xband-snowfall-march-14-2022.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#imports">
   Imports
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#setup-helper-functions">
   Setup Helper Functions
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#define-the-point-retrievals">
   Define the Point Retrievals
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#list-the-available-files">
   List the Available Files
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#read-data-subset-at-points">
   Read Data + Subset at Points
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#loop-through-and-subset-the-radar-fields-at-the-given-points">
     Loop through and subset the radar fields at the given points
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#merge-the-datasets-at-the-end-across-time">
       Merge the datasets at the end across time
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#apply-our-z-s-relationships">
   Apply our Z-S Relationships
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#plot-reflectivity-at-each-site">
   Plot Reflectivity at Each Site
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#define-our-z-s-relationships">
     Define our Z-S Relationships
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#apply-our-z-s-relationships-to-the-dataset">
     Apply our Z(S) Relationships to the Dataset
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#reflectivity-with-height-at-each-site">
   Reflectivity with Height at Each Site
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#look-at-a-timeseries-of-snowfall-rates-and-totals">
   Look at a Timeseries of Snowfall Rates and Totals
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Snowfall Retrievals CSU X-Band Radar March 14, 2022</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#imports">
   Imports
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#setup-helper-functions">
   Setup Helper Functions
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#define-the-point-retrievals">
   Define the Point Retrievals
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#list-the-available-files">
   List the Available Files
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#read-data-subset-at-points">
   Read Data + Subset at Points
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#loop-through-and-subset-the-radar-fields-at-the-given-points">
     Loop through and subset the radar fields at the given points
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#merge-the-datasets-at-the-end-across-time">
       Merge the datasets at the end across time
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#apply-our-z-s-relationships">
   Apply our Z-S Relationships
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#plot-reflectivity-at-each-site">
   Plot Reflectivity at Each Site
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#define-our-z-s-relationships">
     Define our Z-S Relationships
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#apply-our-z-s-relationships-to-the-dataset">
     Apply our Z(S) Relationships to the Dataset
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#reflectivity-with-height-at-each-site">
   Reflectivity with Height at Each Site
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#look-at-a-timeseries-of-snowfall-rates-and-totals">
   Look at a Timeseries of Snowfall Rates and Totals
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="snowfall-retrievals-csu-x-band-radar-march-14-2022">
<h1>Snowfall Retrievals CSU X-Band Radar March 14, 2022<a class="headerlink" href="#snowfall-retrievals-csu-x-band-radar-march-14-2022" title="Permalink to this headline">#</a></h1>
<p>Let’s take a look at precipitation from an event on March 14, 2022 as a part of the SAIL field campaign.</p>
<section id="imports">
<h2>Imports<a class="headerlink" href="#imports" title="Permalink to this headline">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>import glob
import os
import datetime

import numpy as np
import matplotlib.pyplot as plt
import pyart
import xarray as xr
from matplotlib.dates import DateFormatter
import pandas as pd
import geopandas as gpd
import act
import fiona
</pre></div>
</div>
</div>
</div>
</section>
<section id="setup-helper-functions">
<h2>Setup Helper Functions<a class="headerlink" href="#setup-helper-functions" title="Permalink to this headline">#</a></h2>
<p>We setup helper functions to calculate the snowfall retrieval, using following notation:</p>
<p><span class="math notranslate nohighlight">\(Z = A*S ^ {B}\)</span></p>
<p>Where:</p>
<ul class="simple">
<li><p>Z = Reflectivity in dBZ</p></li>
<li><p>A = Coefficient applied to Z-S Relationship (not in the exponent)</p></li>
<li><p>S = Liquid snowfall rate</p></li>
<li><p>B = Coefficient applied to Z-S Relationship (in the exponent)</p></li>
</ul>
<p>We also need to apply a snow water equivalent ratio (<code class="docutils literal notranslate"><span class="pre">swe</span></code>) to convert from liquid to snow (ex. 8 inches of snow –&gt; 1 inch of rain would be 8.0).</p>
<p>This equation now becomes:</p>
<p><span class="math notranslate nohighlight">\(Z = swe*A*S ^ {B}\)</span></p>
<p>Solving for S, we get:</p>
<p><span class="math notranslate nohighlight">\(S = swe * (\frac{z}{a})^{1/B}\)</span></p>
<p>Where z is reflectivity in units of dB (<span class="math notranslate nohighlight">\(z =10^{Z/10}\)</span>)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>def snow_rate(radar, swe_ratio, A, B):
    &quot;&quot;&quot;
    Snow rate applied to a pyart.Radar object
    
    Takes a given Snow Water Equivilent ratio (swe_ratio), A and B value
    for the Z-S relationship and creates a radar field similar to DBZ
    showing the radar estimated snowfall rate in mm/hr. Then the given
    SWE_ratio, A and B are stored in the radar metadata for later 
    reference.

    &quot;&quot;&quot;
    # Setting up for Z-S relationship:
    snow_z = radar.fields[&#39;DBZ&#39;][&#39;data&#39;].copy()
    # Convert it from dB to linear units
    z_lin = 10.0**(radar.fields[&#39;DBZ&#39;][&#39;data&#39;]/10.)
    # Apply the Z-S relation.
    snow_z = swe_ratio * (z_lin/A)**(1./B)
    # Add the field back to the radar. Use reflectivity as a template
    radar.add_field_like(&#39;DBZ&#39;, &#39;snow_z&#39;,  snow_z,
                         replace_existing=True)
    # Update units and metadata
    radar.fields[&#39;snow_z&#39;][&#39;units&#39;] = &#39;mm/h&#39;
    radar.fields[&#39;snow_z&#39;][&#39;standard_name&#39;] = &#39;snowfall_rate&#39;
    radar.fields[&#39;snow_z&#39;][&#39;long_name&#39;] = &#39;snowfall_rate_from_z&#39;
    radar.fields[&#39;snow_z&#39;][&#39;valid_min&#39;] = 0
    radar.fields[&#39;snow_z&#39;][&#39;valid_max&#39;] = 500
    radar.fields[&#39;snow_z&#39;][&#39;swe_ratio&#39;] = swe_ratio
    radar.fields[&#39;snow_z&#39;][&#39;A&#39;] = A
    radar.fields[&#39;snow_z&#39;][&#39;B&#39;] = B
    return radar
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>def snow_rate_from_ds(ds, swe_ratio, A, B, snow_field_name=&quot;snow_z&quot;, reflectivity_field=&#39;DBZ&#39;):
    &quot;&quot;&quot;
    Snow rate applied to an Xarray.Dataset
    
    Takes a given Snow Water Equivilent ratio (SWE_ratio), A and B value
    for the Z-S relationship and creates a radar field similar to DBZ
    showing the radar estimated snowfall rate in mm/hr. Then the given
    SWE_ratio, A and B are stored in the radar metadata for later 
    reference.   
    &quot;&quot;&quot;
    snow_z = ds[reflectivity_field].copy()
    
    # Convert it from dB to linear units
    z_lin = 10.0**(snow_z/10.)
    
    # Apply the Z-S relation.
    snow_z = swe_ratio * (z_lin/A)**(1./B)
    
    ds[snow_field_name] = snow_z
    
    field_attrs = {&quot;units&quot;: &quot;mm/hr&quot;,
                   &quot;standard_name&quot;: &quot;snowfall_rate&quot;,
                   &quot;long_name&quot;:&quot;snowfall_rate_from_z&quot;,
                   &quot;valid_min&quot;:0,
                   &quot;valid_max&quot;:500,
                   &quot;swe_ratio&quot;:swe_ratio,
                   &quot;A&quot;:A,
                   &quot;B&quot;:B}
    
    ds[snow_field_name].attrs = field_attrs
    
    return ds
</pre></div>
</div>
</div>
</div>
</section>
<section id="define-the-point-retrievals">
<h2>Define the Point Retrievals<a class="headerlink" href="#define-the-point-retrievals" title="Permalink to this headline">#</a></h2>
<p>We need to create a set of latitude and longitude values for the different instrumentation locations.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Define the splash locations [lon,lat]
sail = [-106.987, 38.9586]
kettle_ponds = [-106.9731488, 38.9415427]
brush_creek = [-106.920259, 38.8596282]
avery_point = [-106.9965928, 38.9705885]
pumphouse_site = [-106.9502476, 38.9226741]
roaring_judy = [-106.8530215, 38.7170576]
pluvio = [-106.986, 38.9565]

sites = [&quot;sail&quot;, &quot;kettle_ponds&quot;, &quot;brush_creek&quot;, &quot;avery_point&quot;, &quot;pumphouse_site&quot;, &quot;roaring_judy&quot;, &quot;pluvio&quot;]

# Zip these together!
lons, lats = list(zip(sail,
                      kettle_ponds,
                      brush_creek,
                      avery_point,
                      pumphouse_site,
                      roaring_judy,
                      pluvio))
</pre></div>
</div>
</div>
</div>
</section>
<section id="list-the-available-files">
<h2>List the Available Files<a class="headerlink" href="#list-the-available-files" title="Permalink to this headline">#</a></h2>
<p>We will use files on the Oak Ridge Laboratory Computing Facility (ORLCF), within the shared SAIL directory <code class="docutils literal notranslate"><span class="pre">/gpfs/wolf/atm124/proj-shared/sail</span></code>.</p>
<p>These radar files have been merged from a single sweep in each file, to whole volume scans in each file.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>file_list = sorted(glob.glob(&quot;/gpfs/wolf/atm124/proj-shared/sail/202203_glued/xprecipradar_guc_volume_20220314*&quot;))
file_list[:10]
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;/gpfs/wolf/atm124/proj-shared/sail/202203_glued/xprecipradar_guc_volume_20220314-000239.b1.nc&#39;,
 &#39;/gpfs/wolf/atm124/proj-shared/sail/202203_glued/xprecipradar_guc_volume_20220314-000759.b1.nc&#39;,
 &#39;/gpfs/wolf/atm124/proj-shared/sail/202203_glued/xprecipradar_guc_volume_20220314-001319.b1.nc&#39;,
 &#39;/gpfs/wolf/atm124/proj-shared/sail/202203_glued/xprecipradar_guc_volume_20220314-001839.b1.nc&#39;,
 &#39;/gpfs/wolf/atm124/proj-shared/sail/202203_glued/xprecipradar_guc_volume_20220314-002359.b1.nc&#39;,
 &#39;/gpfs/wolf/atm124/proj-shared/sail/202203_glued/xprecipradar_guc_volume_20220314-002919.b1.nc&#39;,
 &#39;/gpfs/wolf/atm124/proj-shared/sail/202203_glued/xprecipradar_guc_volume_20220314-003439.b1.nc&#39;,
 &#39;/gpfs/wolf/atm124/proj-shared/sail/202203_glued/xprecipradar_guc_volume_20220314-003959.b1.nc&#39;,
 &#39;/gpfs/wolf/atm124/proj-shared/sail/202203_glued/xprecipradar_guc_volume_20220314-004519.b1.nc&#39;,
 &#39;/gpfs/wolf/atm124/proj-shared/sail/202203_glued/xprecipradar_guc_volume_20220314-005039.b1.nc&#39;]
</pre></div>
</div>
</div>
</div>
</section>
<section id="read-data-subset-at-points">
<h2>Read Data + Subset at Points<a class="headerlink" href="#read-data-subset-at-points" title="Permalink to this headline">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>def process_point(files, lat, lon):
    &quot;&quot;&quot;Process data for a single point&quot;&quot;&quot;
    ds_all = []
    for file in file_list:
        radar = pyart.io.read(file)
        #-------------------------------------------------------------------------
        # Add in the extra fields to the radar object before extracting the column
        #-------------------------------------------------------------------------
        # Calculate estimated rainfall rate from reflectivty
        #rain = pyart.retrieve.qpe.est_rain_rate_z(radar)
        # Add the estimated rainfall rate back into the radar object
        #radar.add_field(&#39;est_rainfall_rate&#39;, rain)
        # Call Matt&#39;s Z-S function with the constants he used
        radar = snow_rate(radar, 8.5, 28, 1.44)
        #-------------------------------------------------------------------------
        column = pyart.util.columnsect.get_field_location(radar, avery_point[1], avery_point[0])
        # Add a datetime dimension to the xarray radar column
        dt = pd.to_datetime(radar.time[&quot;data&quot;], unit=&#39;s&#39;)[-1]
        coor_ad = column.assign_coords(date=dt.timestamp())
        ncolumn = coor_ad.expand_dims(&#39;date&#39;)
        # Make sure there are no duplicate height indices
        index = np.unique(column[&#39;height&#39;], return_index=True)
        ncolumn = ncolumn.isel(height=index[1])
        # append to the xarray dataset list
        ds_all.append(ncolumn)
    
    # Combine the xarry DataArrays
    ds = xr.concat(ds_all, &#39;date&#39;)
    
    # Correct the datetimes
    ds[&quot;date&quot;] = pd.to_datetime(ds.date.values, unit=&#39;s&#39;)
    
    return ds
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>def subset_points(file, lats, lons, sites):
    &quot;&quot;&quot;Subset a radar file for a set of latitudes and longitudes&quot;&quot;&quot;
    
    # Read in the file
    radar = pyart.io.read(file)
    
    column_list = []
    for lat, lon in zip(lats, lons):
        da = pyart.util.columnsect.get_field_location(radar, lat, lon).interp(height=np.arange(100, 2600, 100))
        da[&quot;latitude&quot;], da[&quot;longitude&quot;] = lat, lon
        dt = pd.to_datetime(radar.time[&quot;data&quot;], unit=&#39;s&#39;)[-1]
        da.expand_dims(&quot;time&quot;)
        da[&quot;time&quot;] = [dt]
        # Make sure there are no duplicate height indices
        index = np.unique(da[&#39;height&#39;], return_index=True)
        ncolumn = da.isel(height=index[1]).dropna(dim=&#39;height&#39;)
        column_list.append(ncolumn)
        
    ds = xr.concat(column_list, dim=&#39;site&#39;)
    ds[&quot;site&quot;] = sites
    return ds
</pre></div>
</div>
</div>
</div>
<section id="loop-through-and-subset-the-radar-fields-at-the-given-points">
<h3>Loop through and subset the radar fields at the given points<a class="headerlink" href="#loop-through-and-subset-the-radar-fields-at-the-given-points" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>%%time
ds_list = []
for file in file_list[:200]:
    ds_list.append(subset_points(file, lats, lons, sites))
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/ccsopen/home/mgrover/mgrover/sail-radar-dev/lib/python3.9/site-packages/pyart/core/transforms.py:177: UserWarning: dot_product is larger than one.
  warnings.warn(&quot;dot_product is larger than one.&quot;)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CPU times: user 9min 41s, sys: 39.4 s, total: 10min 20s
Wall time: 12min
</pre></div>
</div>
</div>
</div>
<section id="merge-the-datasets-at-the-end-across-time">
<h4>Merge the datasets at the end across time<a class="headerlink" href="#merge-the-datasets-at-the-end-across-time" title="Permalink to this headline">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>ds = xr.concat(ds_list, dim=&#39;time&#39;)
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="apply-our-z-s-relationships">
<h2>Apply our Z-S Relationships<a class="headerlink" href="#apply-our-z-s-relationships" title="Permalink to this headline">#</a></h2>
</section>
<section id="plot-reflectivity-at-each-site">
<h2>Plot Reflectivity at Each Site<a class="headerlink" href="#plot-reflectivity-at-each-site" title="Permalink to this headline">#</a></h2>
<p>We loop through and plot reflectivity above each site.</p>
<section id="define-our-z-s-relationships">
<h3>Define our Z-S Relationships<a class="headerlink" href="#define-our-z-s-relationships" title="Permalink to this headline">#</a></h3>
<p>We start by using the Z-S Relationships Described in <a class="reference external" href="https://doi.org/10.1175/JAMC-D-17-0090.1">Bukovčić et al. (2018)</a>, where we refer to following relationships in Table 1:</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="text-align:left head"><p>Source</p></th>
<th class="text-align:center head"><p>Z(S) relation for dry snow</p></th>
<th class="text-align:right head"><p>A Coefficient</p></th>
<th class="text-align:center head"><p>B Coefficient</p></th>
<th class="text-align:center head"><p>Radar Band</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-align:left"><p>Wolfe and Snider (2012)</p></td>
<td class="text-align:center"><p><span class="math notranslate nohighlight">\(Z = {110}S^{2}\)</span></p></td>
<td class="text-align:right"><p>110</p></td>
<td class="text-align:center"><p>2</p></td>
<td class="text-align:center"><p>S</p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p>WSR-88D high plains</p></td>
<td class="text-align:center"><p><span class="math notranslate nohighlight">\(Z = {130}S^{2}\)</span></p></td>
<td class="text-align:right"><p>130</p></td>
<td class="text-align:center"><p>2</p></td>
<td class="text-align:center"><p>S</p></td>
</tr>
<tr class="row-even"><td class="text-align:left"><p>WSR-88D Intermountain West</p></td>
<td class="text-align:center"><p><span class="math notranslate nohighlight">\(Z = {40}S^{2}\)</span></p></td>
<td class="text-align:right"><p>40</p></td>
<td class="text-align:center"><p>2</p></td>
<td class="text-align:center"><p>S</p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p>Matrosov et al.(2009) Braham(1990)</p></td>
<td class="text-align:center"><p><span class="math notranslate nohighlight">\(Z = {67}S^{1.28}\)</span></p></td>
<td class="text-align:right"><p>67</p></td>
<td class="text-align:center"><p>1.28</p></td>
<td class="text-align:center"><p>X</p></td>
</tr>
<tr class="row-even"><td class="text-align:left"><p>Matrosov et al.(2009) Braham(1990)</p></td>
<td class="text-align:center"><p><span class="math notranslate nohighlight">\(Z = {114}S^{1.39}\)</span></p></td>
<td class="text-align:right"><p>114</p></td>
<td class="text-align:center"><p>1.39</p></td>
<td class="text-align:center"><p>X</p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p>Matrosov et al.(2009) Braham(1990)</p></td>
<td class="text-align:center"><p><span class="math notranslate nohighlight">\(Z = {136}S^{1.3}\)</span></p></td>
<td class="text-align:right"><p>136</p></td>
<td class="text-align:center"><p>1.3</p></td>
<td class="text-align:center"><p>X</p></td>
</tr>
<tr class="row-even"><td class="text-align:left"><p>Matrosov et al.(2009) Braham(1990)</p></td>
<td class="text-align:center"><p><span class="math notranslate nohighlight">\(Z = {28}S^{1.44}\)</span></p></td>
<td class="text-align:right"><p>28</p></td>
<td class="text-align:center"><p>1.44</p></td>
<td class="text-align:center"><p>X</p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p>Matrosov et al.(2009) Braham(1990)</p></td>
<td class="text-align:center"><p><span class="math notranslate nohighlight">\(Z = {36}S^{1.56}\)</span></p></td>
<td class="text-align:right"><p>36</p></td>
<td class="text-align:center"><p>1.56</p></td>
<td class="text-align:center"><p>X</p></td>
</tr>
<tr class="row-even"><td class="text-align:left"><p>Matrosov et al.(2009) Braham(1990)</p></td>
<td class="text-align:center"><p><span class="math notranslate nohighlight">\(Z = {48}S^{1.45}\)</span></p></td>
<td class="text-align:right"><p>48</p></td>
<td class="text-align:center"><p>1.45</p></td>
<td class="text-align:center"><p>X</p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p>Matrosov (1992)</p></td>
<td class="text-align:center"><p><span class="math notranslate nohighlight">\(Z = {410}S^{1.6}\)</span></p></td>
<td class="text-align:right"><p>410</p></td>
<td class="text-align:center"><p>1.6</p></td>
<td class="text-align:center"><p>X</p></td>
</tr>
<tr class="row-even"><td class="text-align:left"><p>Matrosov (1992)</p></td>
<td class="text-align:center"><p><span class="math notranslate nohighlight">\(Z = {340}S^{1.6}\)</span></p></td>
<td class="text-align:right"><p>340</p></td>
<td class="text-align:center"><p>1.75</p></td>
<td class="text-align:center"><p>X</p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p>Matrosov (1992)</p></td>
<td class="text-align:center"><p><span class="math notranslate nohighlight">\(Z = {240}S^{1.6}\)</span></p></td>
<td class="text-align:right"><p>240</p></td>
<td class="text-align:center"><p>1.95</p></td>
<td class="text-align:center"><p>X</p></td>
</tr>
<tr class="row-even"><td class="text-align:left"><p>Boucher and Wieler (1985)</p></td>
<td class="text-align:center"><p><span class="math notranslate nohighlight">\(Z = {229}S^{1.65}\)</span></p></td>
<td class="text-align:right"><p>229</p></td>
<td class="text-align:center"><p>1.65</p></td>
<td class="text-align:center"><p>X</p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p>Fujiyoshi et al. (1990)</p></td>
<td class="text-align:center"><p><span class="math notranslate nohighlight">\(Z = {427}S^{1.09}\)</span></p></td>
<td class="text-align:right"><p>427</p></td>
<td class="text-align:center"><p>1.09</p></td>
<td class="text-align:center"><p>X</p></td>
</tr>
<tr class="row-even"><td class="text-align:left"><p>Puhakka (1975)</p></td>
<td class="text-align:center"><p><span class="math notranslate nohighlight">\(Z = {1050}S^{2}\)</span></p></td>
<td class="text-align:right"><p>1050</p></td>
<td class="text-align:center"><p>2</p></td>
<td class="text-align:center"><p>X</p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p>Sekhon and Srivastava (1970)</p></td>
<td class="text-align:center"><p><span class="math notranslate nohighlight">\(Z = {1780}S^{2.21}\)</span></p></td>
<td class="text-align:right"><p>1780</p></td>
<td class="text-align:center"><p>2.21</p></td>
<td class="text-align:center"><p>X</p></td>
</tr>
</tbody>
</table>
<p>We can plug these into a dictionary for safe keeping.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>zs_relationship_dict = {&quot;Wolf_and_Snider&quot;:
                        {&quot;A&quot;: 110,
                         &quot;B&quot;: 2},
                        &quot;WSR_88D_High_Plains&quot;:
                        {&quot;A&quot;: 130,
                         &quot;B&quot;: 2},
                        &quot;WSR_88D_Intermountain_West&quot;:
                        {&quot;A&quot;: 40,
                         &quot;B&quot;: 2},
                        &quot;Matrosov et al.(2009) Braham(1990) 1&quot;:
                        {&quot;A&quot;: 67,
                         &quot;B&quot;: 1.28},
                         &quot;Matrosov et al.(2009) Braham(1990) 2&quot;:
                        {&quot;A&quot;: 114,
                         &quot;B&quot;: 1.39},
                         &quot;Matrosov et al.(2009) Braham(1990) 3&quot;:
                        {&quot;A&quot;: 136,
                         &quot;B&quot;: 1.3},
                         &quot;Matrosov et al.(2009) Braham(1990) 4&quot;:
                        {&quot;A&quot;: 28,
                         &quot;B&quot;: 1.44,},
                         &quot;Matrosov et al.(2009) Braham(1990) 5&quot;:
                        {&quot;A&quot;: 36,
                         &quot;B&quot;: 1.56},
                         &quot;Matrosov et al.(2009) Braham(1990) 6&quot;:
                        {&quot;A&quot;: 48,
                         &quot;B&quot;: 1.45},
                       }
</pre></div>
</div>
</div>
</div>
</section>
<section id="apply-our-z-s-relationships-to-the-dataset">
<h3>Apply our Z(S) Relationships to the Dataset<a class="headerlink" href="#apply-our-z-s-relationships-to-the-dataset" title="Permalink to this headline">#</a></h3>
<p>Once we have our dictionary from above, we can apply it to our dataset, using a constant value of a snow liquid water equivalent of 8.5</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>for relationship in zs_relationship_dict.keys():
    snow_rate_from_ds(ds,
                      8.5,
                      zs_relationship_dict[relationship][&quot;A&quot;],
                      zs_relationship_dict[relationship][&quot;B&quot;],
                      snow_field_name=relationship)
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="reflectivity-with-height-at-each-site">
<h2>Reflectivity with Height at Each Site<a class="headerlink" href="#reflectivity-with-height-at-each-site" title="Permalink to this headline">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>for site in ds.site:
    ds.sel(site=site).DBZ.plot(x=&#39;time&#39;,
                             cmap=&#39;pyart_HomeyerRainbow&#39;,
                             vmin=-20,
                             vmax=40)
    plt.ylim(0, 2000)
    plt.show()
    plt.close()
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/csu-xband-snowfall-march-14-2022_22_0.png" src="../_images/csu-xband-snowfall-march-14-2022_22_0.png" />
<img alt="../_images/csu-xband-snowfall-march-14-2022_22_1.png" src="../_images/csu-xband-snowfall-march-14-2022_22_1.png" />
<img alt="../_images/csu-xband-snowfall-march-14-2022_22_2.png" src="../_images/csu-xband-snowfall-march-14-2022_22_2.png" />
<img alt="../_images/csu-xband-snowfall-march-14-2022_22_3.png" src="../_images/csu-xband-snowfall-march-14-2022_22_3.png" />
<img alt="../_images/csu-xband-snowfall-march-14-2022_22_4.png" src="../_images/csu-xband-snowfall-march-14-2022_22_4.png" />
<img alt="../_images/csu-xband-snowfall-march-14-2022_22_5.png" src="../_images/csu-xband-snowfall-march-14-2022_22_5.png" />
<img alt="../_images/csu-xband-snowfall-march-14-2022_22_6.png" src="../_images/csu-xband-snowfall-march-14-2022_22_6.png" />
</div>
</div>
</section>
<section id="look-at-a-timeseries-of-snowfall-rates-and-totals">
<h2>Look at a Timeseries of Snowfall Rates and Totals<a class="headerlink" href="#look-at-a-timeseries-of-snowfall-rates-and-totals" title="Permalink to this headline">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>date_form = DateFormatter(&quot;%H%M UTC %b %d %Y&quot;)
min_value = 0
max_value = 30

fig = plt.figure(figsize=(20,8))

for site in range(len(ds.site.values)):
    ds_at_site = ds.isel(site=site).dropna(dim=&#39;height&#39;)
    site_name = ds_at_site.site.values
    ax=plt.subplot(int(f&quot;42{site+1}&quot;))
    for relationship in zs_relationship_dict.keys():
        relationship_name = relationship.replace(&quot;_&quot;, &quot; &quot;)
        a_coefficeint = ds[relationship].A
        b_coefficeint = ds[relationship].B
        relationship_equation = f&quot;$Z = {a_coefficeint}S^{b_coefficeint}$&quot;
        
        ds_at_site.isel(height=0)[relationship].plot(label=f&#39;{relationship_name} ({relationship_equation})&#39;,
                                                     ax=ax)
        ax.xaxis.set_major_formatter(date_form)
        plt.legend(fontsize=8, loc=&#39;upper right&#39;)
        
    plt.title(f&quot;Radar Estimated Snowfall Rate at &#39;{site_name}&#39; (lat = {ds_at_site.latitude.values[0]}, lon = {ds_at_site.longitude.values[0]})&quot;)

for ax in fig.axes[:-2]:
    ax.axes.axis(&quot;tight&quot;)
    ax.axes.get_xaxis().set_ticklabels([])
    ax.set_ylabel(&quot;Snowfall rate \n (mm/hour)&quot;)
    ax.set_xlabel(&quot;&quot;)
    ax.set_ylim(min_value, max_value)

for ax in fig.axes[-2:]:
    ax.axes.axis(&quot;tight&quot;)
    ax.set_ylabel(&quot;Snowfall rate \n (mm/hour)&quot;)
    ax.set_ylim(min_value, max_value)
    
plt.suptitle(&quot;Estimated Snowfall Rates from X-Band Radar \n SAIL Domain 14 March 2022&quot;, fontsize=18)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0.5, 0.98, &#39;Estimated Snowfall Rates from X-Band Radar \n SAIL Domain 14 March 2022&#39;)
</pre></div>
</div>
<img alt="../_images/csu-xband-snowfall-march-14-2022_24_1.png" src="../_images/csu-xband-snowfall-march-14-2022_24_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>date_form = DateFormatter(&quot;%H%M UTC %b %d %Y&quot;)
min_value = 0
max_value = 1000

fig = plt.figure(figsize=(20,8))

for site in range(len(ds.site.values)):
    ds_at_site = ds.isel(site=site).dropna(dim=&#39;height&#39;)
    site_name = ds_at_site.site.values
    ax=plt.subplot(int(f&quot;42{site+1}&quot;))
    for relationship in zs_relationship_dict.keys():
        relationship_name = relationship.replace(&quot;_&quot;, &quot; &quot;)
        a_coefficeint = ds[relationship].A
        b_coefficeint = ds[relationship].B
        relationship_equation = f&quot;$Z = {a_coefficeint}S^{b_coefficeint}$&quot;
        
        ds_at_site.isel(height=0)[relationship].cumsum(&quot;time&quot;).plot(label=f&#39;{relationship_name} ({relationship_equation})&#39;,
                                                                    ax=ax)
        plt.ylim(min_value, max_value)
        ax.xaxis.set_major_formatter(date_form)
        plt.legend(fontsize=8, loc=&#39;upper right&#39;)
        
    plt.title(f&quot;Radar Estimated Cumulative Snowfall at &#39;{site_name}&#39; (lat = {ds_at_site.latitude.values[0]}, lon = {ds_at_site.longitude.values[0]})&quot;)

for ax in fig.axes[:-2]:
    ax.axes.axis(&quot;tight&quot;)
    ax.axes.get_xaxis().set_ticklabels([])
    ax.set_ylabel(&quot;Cumulative Snowfall \n (mm)&quot;)
    ax.set_xlabel(&quot;&quot;)
    ax.set_ylim(min_value, max_value)

for ax in fig.axes[-2:]:
    ax.axes.axis(&quot;tight&quot;)
    ax.set_ylabel(&quot;Cumulative Snowfall \n (mm)&quot;)
    ax.set_ylim(min_value, max_value)
    
plt.suptitle(&quot;Estimated Cumulative Snowfall Totals from X-Band Radar \n SAIL Domain 14 March 2022&quot;, fontsize=18)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0.5, 0.98, &#39;Estimated Cumulative Snowfall Totals from X-Band Radar \n SAIL Domain 14 March 2022&#39;)
</pre></div>
</div>
<img alt="../_images/csu-xband-snowfall-march-14-2022_25_1.png" src="../_images/csu-xband-snowfall-march-14-2022_25_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>ds.to_netcdf(&quot;sail_snowfall_retrievals_march_14_2022.nc&quot;)
</pre></div>
</div>
</div>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "sail-radar-dev"
        },
        kernelOptions: {
            kernelName: "sail-radar-dev",
            path: "./radar-precip"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'sail-radar-dev'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="compare-with-kazr.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Check Reflectivity Calibration</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="plot-ams-figures.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Plot PPI data for BAMS Paper</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By ARM Development Team<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>