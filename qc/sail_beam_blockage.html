
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Beam Blockage for SAIL &#8212; SAIL X-Band Radar Precipitation</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script async="async" kind="hypothesis" src="https://hypothes.is/embed.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Explore Dual-Pol Data from SAIL" href="../dual-pol/dual-pol-exploration.html" />
    <link rel="prev" title="&lt;no title&gt;" href="../gluing_and_inventory/sail_inventory.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../_static/arm_logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">SAIL X-Band Radar Precipitation</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../overview.html">
                    Surface Atmosphere Integrated Field Laboratory (SAIL) Radar Analysis
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Looking at the Domain
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../domain-exploration/plot-sail-splash-sites.html">
   Plot the SAIL and SPLASH Locations
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Apply Quality Control/Assurance
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../gluing_and_inventory/concatinate_file.html">
   Gluing and Merging
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Beam Blockage for SAIL
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Dual-Pol Exploration
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../dual-pol/dual-pol-exploration.html">
   Explore Dual-Pol Data from SAIL
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../dual-pol/kdp-xradar-exploration.html">
   Investigate KDP and PhiDP through a Convective Core near SAIL
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Investigate Precipitation
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../radar-precip/compare-with-kazr.html">
   Check Reflectivity Calibration
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../radar-precip/csu-xband-snowfall-march-14-2022.html">
   Snowfall Retrievals CSU X-Band Radar March 14, 2022
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../radar-precip/plot-ams-figures.html">
   Plot PPI data for BAMS Paper
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../radar-precip/plot-method-description-figure.html">
   Plot a Description of the Liquid Precip Estimation Method
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Value Added Products
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../VAP/cmac2_technical_document.html">
   Figures for the SAIL CMAC2.0 Technical Document
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../VAP/matched_dataset_march_14_2022.html">
   Extracted Radar Columns and In-Situ Sensors (RadCLss) Dataset
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../VAP/nearest-neighbor-interpolation.html">
   Grid QC’d Dataset - Surface QUantitatIve pRecipitation Estimation (SQUIRE)
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/ARM-Development/sail-xprecip-radar/main?urlpath=lab/tree/notebooks/qc/sail_beam_blockage.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
      <li>
        <a href="https://jupyter-open.olcf.ornl.gov/hub/user-redirect/git-pull?repo=https%3A//github.com/ARM-Development/sail-xprecip-radar&urlpath=lab/tree/sail-xprecip-radar/notebooks/qc/sail_beam_blockage.ipynb&branch=main"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on JupyterHub"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../_static/images/logo_jupyterhub.svg">
  </span>
<span class="headerbtn__text-container">JupyterHub</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../_sources/qc/sail_beam_blockage.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#needed-to-fix-range-offset-otherwise-cumulative-beam-blockage-is-wrong">
   Needed to fix range offset otherwise cumulative beam blockage is wrong
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#calculate-pbb-and-cbb">
   Calculate PBB and CBB
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#see-the-blockage-diminish-as-fixed-angle-increases">
   See the blockage diminish as fixed angle increases
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Beam Blockage for SAIL</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#needed-to-fix-range-offset-otherwise-cumulative-beam-blockage-is-wrong">
   Needed to fix range offset otherwise cumulative beam blockage is wrong
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#calculate-pbb-and-cbb">
   Calculate PBB and CBB
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#see-the-blockage-diminish-as-fixed-angle-increases">
   See the blockage diminish as fixed angle increases
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="beam-blockage-for-sail">
<h1>Beam Blockage for SAIL<a class="headerlink" href="#beam-blockage-for-sail" title="Permalink to this headline">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>import pyart
import wradlib as wrl
import cartopy.crs as ccrs
import numpy as np
import matplotlib.pyplot as plt
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>## You are using the Python ARM Radar Toolkit (Py-ART), an open source
## library for working with weather radar data. Py-ART is partly
## supported by the U.S. Department of Energy as part of the Atmospheric
## Radiation Measurement (ARM) Climate Research Facility, an Office of
## Science user facility.
##
## If you use this software to prepare a publication, please cite:
##
##     JJ Helmus and SM Collis, JORS 2016, doi: 10.5334/jors.119
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>radar = pyart.io.read(&#39;/home/zsherman/Downloads/xprecipradar_guc_volume_20220217-230559.b1.nc&#39;)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>radar.fields.keys()
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>dict_keys([&#39;DBZ&#39;, &#39;VEL&#39;, &#39;WIDTH&#39;, &#39;ZDR&#39;, &#39;PHIDP&#39;, &#39;RHOHV&#39;, &#39;NCP&#39;, &#39;SNR&#39;, &#39;DBZhv&#39;])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>display = pyart.graph.RadarMapDisplay(radar)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/zsherman/anaconda3/envs/pyart_env/lib/python3.8/site-packages/cartopy/crs.py:2320: DeprecationWarning: `np.float` is a deprecated alias for the builtin `float`. To silence this warning, use `float` by itself. Doing this will not modify any behavior and is safe. If you specifically wanted the numpy scalar type, use `np.float64` here.
Deprecated in NumPy 1.20; for more details and guidance: https://numpy.org/devdocs/release/1.20.0-notes.html#deprecations
  a = np.float(self.globe.semimajor_axis or WGS84_SEMIMAJOR_AXIS)
/home/zsherman/anaconda3/envs/pyart_env/lib/python3.8/site-packages/cartopy/crs.py:2321: DeprecationWarning: `np.float` is a deprecated alias for the builtin `float`. To silence this warning, use `float` by itself. Doing this will not modify any behavior and is safe. If you specifically wanted the numpy scalar type, use `np.float64` here.
Deprecated in NumPy 1.20; for more details and guidance: https://numpy.org/devdocs/release/1.20.0-notes.html#deprecations
  b = np.float(self.globe.semiminor_axis or a)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>fig = plt.figure(figsize=(10, 10))
display.plot_ppi_map(&#39;DBZ&#39;, 0)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/zsherman/dev/pyart/pyart/graph/radarmapdisplay.py:281: UserWarning: No projection was defined for the axes. Overridding defined axes and using default axes with projection Lambert Conformal.
  warnings.warn(
</pre></div>
</div>
<img alt="../_images/sail_beam_blockage_5_1.png" src="../_images/sail_beam_blockage_5_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>radar.altitude[&#39;data&#39;]
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>masked_array(data=[3149.19995117],
             mask=False,
       fill_value=1e+20)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>radar.nsweeps
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>8
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>tif_file = &#39;/home/zsherman/Downloads/sail.tif&#39;
#tif_file  = &#39;/home/zsherman/Downloads/dsm_mosaic_min_phase_me.tif&#39;
#tif_file = &#39;/home/zsherman/Downloads/tch_mosaic_min_phase_me.tif&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>def beam_block(radar, tif_file, radar_height_offset=10.0,
               beam_width=1.0):
    &quot;&quot;&quot;
    Beam Block Radar Calculation.
    Parameters
    ----------
    radar : Radar
        Radar object used.
    tif_name : string
        Name of geotiff file to use for the
        calculation.
    radar_height_offset : float
        Add height to the radar altitude for radar towers.
    Other Parameters
    ----------------
    beam_width : float
        Radar&#39;s beam width for calculation.
        Default value is 1.0.
    Returns
    -------
    pbb_all : array
        Array of partial beam block fractions for each
        gate in all sweeps.
    cbb_all : array
        Array of cumulative beam block fractions for
        each gate in all sweeps.
    References
    ----------
    Bech, J., B. Codina, J. Lorente, and D. Bebbington,
    2003: The sensitivity of single polarization weather
    radar beam blockage correction to variability in the
    vertical refractivity gradient. J. Atmos. Oceanic
    Technol., 20, 845–855
    Heistermann, M., Jacobi, S., and Pfaff, T., 2013:
    Technical Note: An open source library for processing
    weather radar data (wradlib), Hydrol. Earth Syst.
    Sci., 17, 863-871, doi:10.5194/hess-17-863-2013
    Helmus, J.J. &amp; Collis, S.M., (2016). The Python ARM
    Radar Toolkit (Py-ART), a Library for Working with
    Weather Radar Data in the Python Programming Language.
    Journal of Open Research Software. 4(1), p.e25.
    DOI: http://doi.org/10.5334/jors.119
    &quot;&quot;&quot;
    # Opening the tif file and getting the values ready to be
    # converted into polar values.
    rasterfile = tif_file
    data_raster = wrl.io.open_raster(rasterfile)
    rastervalues, rastercoords, proj = wrl.georef.extract_raster_dataset(
        data_raster, nodata=None)
    #rastervalues_, rastercoords_, proj = wrl.georef.extract_raster_dataset(data_raster, nodata=-32768.)
    sitecoords = (np.float(radar.longitude[&#39;data&#39;]),
                  np.float(radar.latitude[&#39;data&#39;]),
                  np.float(radar.altitude[&#39;data&#39;] + radar_height_offset))
    pbb_arrays = []
    cbb_arrays = []
    _range = radar.range[&#39;data&#39;]
    beamradius = wrl.util.half_power_radius(_range, beam_width)
    # Cycling through all sweeps in the radar object.
    print(&#39;Calculating beam blockage.&#39;)
    del data_raster
    for i in range(len(radar.sweep_start_ray_index[&#39;data&#39;])):
        index_start = radar.sweep_start_ray_index[&#39;data&#39;][i]
        index_end = radar.sweep_end_ray_index[&#39;data&#39;][i] + 1
        elevs = radar.elevation[&#39;data&#39;][index_start:index_end]
        azimuths = radar.azimuth[&#39;data&#39;][index_start:index_end]
        rg, azg = np.meshgrid(_range, azimuths)
        rg, eleg = np.meshgrid(_range, elevs)
        nrays = azimuths.shape[0]              # number of rays
        nbins = radar.ngates                   # number of range bins
        bw = beam_width                        # half power beam width (deg)
        range_res = 60.                       # range resolution (meters)
        el = radar.fixed_angle[&#39;data&#39;][i]
        coord = wrl.georef.sweep_centroids(nrays, range_res, nbins, el)
        coords = wrl.georef.spherical_to_proj(rg, azg, eleg,
                                              sitecoords, proj=proj)
        lon = coords[..., 0]
        lat = coords[..., 1]
        alt = coords[..., 2]
        polcoords = coords[..., :2]
        rlimits = (lon.min(), lat.min(), lon.max(), lat.max())

        #Clip the region inside our bounding box
        ind = wrl.util.find_bbox_indices(rastercoords, rlimits)
        rastercoords = rastercoords[ind[0]:ind[3], ind[0]:ind[2], ...]
        rastervalues = rastervalues[ind[0]:ind[3], ind[0]:ind[2]]
        polarvalues = wrl.ipol.cart_to_irregular_spline(
            rastercoords, rastervalues, polcoords, order=3,
            prefilter=False)
        # Calculate partial beam blockage using wradlib.
        pbb = wrl.qual.beam_block_frac(polarvalues, alt, beamradius)
        pbb = np.ma.masked_invalid(pbb)
        pbb[pbb &lt; 0] = 0.0
        pbb[pbb &gt; 1] = 1.0
        pbb_arrays.append(pbb)
        # Calculate cumulative beam blockage using wradlib.
        cbb = wrl.qual.cum_beam_block_frac(pbb)
        cbb_arrays.append(cbb)
    pbb_all = np.ma.concatenate(pbb_arrays)
    cbb_all = np.ma.concatenate(cbb_arrays)
    return pbb_all, cbb_all
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>def pbb_to_dict(pbb_all):
    &quot;&quot;&quot; Function that takes the pbb_all array and turns
    it into a dictionary to be used and added to the
    pyart radar object. &quot;&quot;&quot;
    pbb_dict = {}
    pbb_dict[&#39;coordinates&#39;] = &#39;elevation azimuth range&#39;
    pbb_dict[&#39;units&#39;] = &#39;1&#39;
    pbb_dict[&#39;data&#39;] = pbb_all
    pbb_dict[&#39;long_name&#39;] = &#39;Partial Beam Block Fraction&#39;
    pbb_dict[&#39;comment&#39;] = &#39;Partial beam block fraction due to terrain.&#39;
    return pbb_dict


def cbb_to_dict(cbb_all):
    &quot;&quot;&quot; Function that takes the cbb_all array and turns
    it into a dictionary to be used and added to the
    pyart radar object. &quot;&quot;&quot;
    cbb_dict = {}
    cbb_dict[&#39;coordinates&#39;] = &#39;elevation azimuth range&#39;
    cbb_dict[&#39;units&#39;] = &#39;1&#39;
    cbb_dict[&#39;data&#39;] = cbb_all
    cbb_dict[&#39;long_name&#39;] = &#39;Cumulative Beam Block Fraction&#39;
    cbb_dict[&#39;comment&#39;] = &#39;Cumulative beam block fraction due to terrain.&#39;
    return cbb_dict


def cbb_flags_to_dict(cbb_flags):
    &quot;&quot;&quot; Function that takes the cbb_flag array and turns
    it into a dictionary to be used and added to the
    pyart radar object. &quot;&quot;&quot;
    cbb_dict = {}
    cbb_dict[&#39;coordinates&#39;] = &#39;elevation azimuth range&#39;
    cbb_dict[&#39;units&#39;] = &#39;1&#39;
    cbb_dict[&#39;data&#39;] = cbb_flags
    cbb_dict[&#39;long_name&#39;] = &#39;Cumulative Beam Block Fraction Flag&#39;
    cbb_dict[&#39;comment&#39;] = &#39;Cumulative beam block flag due to terrain.&#39;
    return cbb_dict
</pre></div>
</div>
</div>
</div>
<section id="needed-to-fix-range-offset-otherwise-cumulative-beam-blockage-is-wrong">
<h2>Needed to fix range offset otherwise cumulative beam blockage is wrong<a class="headerlink" href="#needed-to-fix-range-offset-otherwise-cumulative-beam-blockage-is-wrong" title="Permalink to this headline">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>radar.range
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;long_name&#39;: &#39;range_to_measurement_volume&#39;,
 &#39;units&#39;: &#39;meters&#39;,
 &#39;standard_name&#39;: &#39;projection_range_coordinate&#39;,
 &#39;spacing_is_constant&#39;: &#39;true&#39;,
 &#39;meters_to_center_of_first_gate&#39;: -112.830795,
 &#39;meters_between_gates&#39;: 59.94095,
 &#39;axis&#39;: &#39;radial_range_coordinate&#39;,
 &#39;data&#39;: masked_array(data=[-1.12830795e+02, -5.28898468e+01,  7.05110168e+00,
                     6.69920502e+01,  1.26932999e+02,  1.86873947e+02,
                     2.46814896e+02,  3.06755859e+02,  3.66696808e+02,
                     4.26637756e+02,  4.86578705e+02,  5.46519653e+02,
                     6.06460571e+02,  6.66401489e+02,  7.26342529e+02,
                     7.86283447e+02,  8.46224365e+02,  9.06165344e+02,
                     9.66106323e+02,  1.02604724e+03,  1.08598816e+03,
                     1.14592908e+03,  1.20587012e+03,  1.26581104e+03,
                     1.32575195e+03,  1.38569299e+03,  1.44563379e+03,
                     1.50557483e+03,  1.56551587e+03,  1.62545667e+03,
                     1.68539771e+03,  1.74533862e+03,  1.80527954e+03,
                     1.86522058e+03,  1.92516150e+03,  1.98510242e+03,
                     2.04504346e+03,  2.10498413e+03,  2.16492529e+03,
                     2.22486621e+03,  2.28480713e+03,  2.34474829e+03,
                     2.40468896e+03,  2.46462988e+03,  2.52457104e+03,
                     2.58451196e+03,  2.64445288e+03,  2.70439380e+03,
                     2.76433472e+03,  2.82427563e+03,  2.88421680e+03,
                     2.94415771e+03,  3.00409839e+03,  3.06403955e+03,
                     3.12398047e+03,  3.18392139e+03,  3.24386255e+03,
                     3.30380322e+03,  3.36374414e+03,  3.42368530e+03,
                     3.48362622e+03,  3.54356714e+03,  3.60350806e+03,
                     3.66344897e+03,  3.72338989e+03,  3.78333105e+03,
                     3.84327197e+03,  3.90321265e+03,  3.96315381e+03,
                     4.02309473e+03,  4.08303564e+03,  4.14297656e+03,
                     4.20291748e+03,  4.26285889e+03,  4.32279932e+03,
                     4.38274023e+03,  4.44268115e+03,  4.50262207e+03,
                     4.56256299e+03,  4.62250439e+03,  4.68244531e+03,
                     4.74238623e+03,  4.80232715e+03,  4.86226807e+03,
                     4.92220850e+03,  4.98214990e+03,  5.04209082e+03,
                     5.10203174e+03,  5.16197266e+03,  5.22191357e+03,
                     5.28185449e+03,  5.34179590e+03,  5.40173682e+03,
                     5.46167773e+03,  5.52161816e+03,  5.58155908e+03,
                     5.64150000e+03,  5.70144141e+03,  5.76138232e+03,
                     5.82132324e+03,  5.88126416e+03,  5.94120508e+03,
                     6.00114600e+03,  6.06108740e+03,  6.12102783e+03,
                     6.18096875e+03,  6.24090967e+03,  6.30085059e+03,
                     6.36079150e+03,  6.42073291e+03,  6.48067383e+03,
                     6.54061475e+03,  6.60055566e+03,  6.66049658e+03,
                     6.72043701e+03,  6.78037842e+03,  6.84031934e+03,
                     6.90026025e+03,  6.96020117e+03,  7.02014209e+03,
                     7.08008301e+03,  7.14002441e+03,  7.19996533e+03,
                     7.25990625e+03,  7.31984668e+03,  7.37978760e+03,
                     7.43972852e+03,  7.49966992e+03,  7.55961084e+03,
                     7.61955176e+03,  7.67949268e+03,  7.73943359e+03,
                     7.79937451e+03,  7.85931543e+03,  7.91925635e+03,
                     7.97919727e+03,  8.03913818e+03,  8.09907910e+03,
                     8.15902002e+03,  8.21896094e+03,  8.27890234e+03,
                     8.33884277e+03,  8.39878418e+03,  8.45872559e+03,
                     8.51866602e+03,  8.57860742e+03,  8.63854785e+03,
                     8.69848926e+03,  8.75842969e+03,  8.81837012e+03,
                     8.87831152e+03,  8.93825195e+03,  8.99819336e+03,
                     9.05813379e+03,  9.11807520e+03,  9.17801660e+03,
                     9.23795703e+03,  9.29789844e+03,  9.35783887e+03,
                     9.41778027e+03,  9.47772168e+03,  9.53766211e+03,
                     9.59760352e+03,  9.65754395e+03,  9.71748535e+03,
                     9.77742578e+03,  9.83736719e+03,  9.89730859e+03,
                     9.95724805e+03,  1.00171895e+04,  1.00771299e+04,
                     1.01370713e+04,  1.01970117e+04,  1.02569531e+04,
                     1.03168945e+04,  1.03768350e+04,  1.04367764e+04,
                     1.04967168e+04,  1.05566582e+04,  1.06165996e+04,
                     1.06765400e+04,  1.07364814e+04,  1.07964219e+04,
                     1.08563633e+04,  1.09163047e+04,  1.09762451e+04,
                     1.10361865e+04,  1.10961270e+04,  1.11560674e+04,
                     1.12160078e+04,  1.12759492e+04,  1.13358906e+04,
                     1.13958311e+04,  1.14557725e+04,  1.15157129e+04,
                     1.15756543e+04,  1.16355947e+04,  1.16955361e+04,
                     1.17554775e+04,  1.18154180e+04,  1.18753594e+04,
                     1.19352998e+04,  1.19952412e+04,  1.20551826e+04,
                     1.21151230e+04,  1.21750645e+04,  1.22350049e+04,
                     1.22949453e+04,  1.23548857e+04,  1.24148271e+04,
                     1.24747686e+04,  1.25347090e+04,  1.25946504e+04,
                     1.26545908e+04,  1.27145322e+04,  1.27744736e+04,
                     1.28344141e+04,  1.28943555e+04,  1.29542959e+04,
                     1.30142373e+04,  1.30741777e+04,  1.31341191e+04,
                     1.31940605e+04,  1.32540010e+04,  1.33139424e+04,
                     1.33738828e+04,  1.34338242e+04,  1.34937646e+04,
                     1.35537051e+04,  1.36136465e+04,  1.36735869e+04,
                     1.37335283e+04,  1.37934688e+04,  1.38534102e+04,
                     1.39133516e+04,  1.39732920e+04,  1.40332334e+04,
                     1.40931738e+04,  1.41531152e+04,  1.42130566e+04,
                     1.42729971e+04,  1.43329385e+04,  1.43928789e+04,
                     1.44528203e+04,  1.45127607e+04,  1.45727021e+04,
                     1.46326436e+04,  1.46925830e+04,  1.47525244e+04,
                     1.48124648e+04,  1.48724062e+04,  1.49323477e+04,
                     1.49922881e+04,  1.50522295e+04,  1.51121699e+04,
                     1.51721113e+04,  1.52320518e+04,  1.52919932e+04,
                     1.53519346e+04,  1.54118750e+04,  1.54718164e+04,
                     1.55317568e+04,  1.55916982e+04,  1.56516396e+04,
                     1.57115801e+04,  1.57715215e+04,  1.58314609e+04,
                     1.58914023e+04,  1.59513428e+04,  1.60112842e+04,
                     1.60712256e+04,  1.61311660e+04,  1.61911074e+04,
                     1.62510479e+04,  1.63109893e+04,  1.63709307e+04,
                     1.64308711e+04,  1.64908125e+04,  1.65507539e+04,
                     1.66106934e+04,  1.66706348e+04,  1.67305762e+04,
                     1.67905176e+04,  1.68504570e+04,  1.69103984e+04,
                     1.69703398e+04,  1.70302812e+04,  1.70902207e+04,
                     1.71501641e+04,  1.72101035e+04,  1.72700449e+04,
                     1.73299844e+04,  1.73899277e+04,  1.74498672e+04,
                     1.75098086e+04,  1.75697500e+04,  1.76296895e+04,
                     1.76896309e+04,  1.77495703e+04,  1.78095137e+04,
                     1.78694531e+04,  1.79293945e+04,  1.79893359e+04,
                     1.80492773e+04,  1.81092168e+04,  1.81691602e+04,
                     1.82290996e+04,  1.82890410e+04,  1.83489805e+04,
                     1.84089238e+04,  1.84688633e+04,  1.85288047e+04,
                     1.85887461e+04,  1.86486875e+04,  1.87086270e+04,
                     1.87685684e+04,  1.88285098e+04,  1.88884492e+04,
                     1.89483906e+04,  1.90083320e+04,  1.90682734e+04,
                     1.91282129e+04,  1.91881543e+04,  1.92480957e+04,
                     1.93080371e+04,  1.93679766e+04,  1.94279199e+04,
                     1.94878594e+04,  1.95478008e+04,  1.96077402e+04,
                     1.96676836e+04,  1.97276230e+04,  1.97875645e+04,
                     1.98475059e+04,  1.99074473e+04,  1.99673867e+04,
                     2.00273281e+04,  2.00872695e+04,  2.01472090e+04,
                     2.02071504e+04,  2.02670918e+04,  2.03270332e+04,
                     2.03869727e+04,  2.04469160e+04,  2.05068555e+04,
                     2.05667969e+04,  2.06267363e+04,  2.06866797e+04,
                     2.07466191e+04,  2.08065605e+04,  2.08665020e+04,
                     2.09264434e+04,  2.09863828e+04,  2.10463262e+04,
                     2.11062656e+04,  2.11662051e+04,  2.12261465e+04,
                     2.12860879e+04,  2.13460293e+04,  2.14059688e+04,
                     2.14659121e+04,  2.15258516e+04,  2.15857930e+04,
                     2.16457324e+04,  2.17056758e+04,  2.17656152e+04,
                     2.18255566e+04,  2.18854980e+04,  2.19454395e+04,
                     2.20053789e+04,  2.20653203e+04,  2.21252617e+04,
                     2.21852031e+04,  2.22451426e+04,  2.23050859e+04,
                     2.23650254e+04,  2.24249648e+04,  2.24849062e+04,
                     2.25448477e+04,  2.26047891e+04,  2.26647285e+04,
                     2.27246719e+04,  2.27846113e+04,  2.28445527e+04,
                     2.29044941e+04,  2.29644355e+04,  2.30243750e+04,
                     2.30843164e+04,  2.31442578e+04,  2.32041992e+04,
                     2.32641387e+04,  2.33240820e+04,  2.33840215e+04,
                     2.34439629e+04,  2.35039023e+04,  2.35638438e+04,
                     2.36237852e+04,  2.36837246e+04,  2.37436680e+04,
                     2.38036074e+04,  2.38635488e+04,  2.39234883e+04,
                     2.39834316e+04,  2.40433711e+04,  2.41033125e+04,
                     2.41632539e+04,  2.42231953e+04,  2.42831348e+04,
                     2.43430781e+04,  2.44030176e+04,  2.44629590e+04,
                     2.45228984e+04,  2.45828418e+04,  2.46427812e+04,
                     2.47027207e+04,  2.47626641e+04,  2.48226035e+04,
                     2.48825449e+04,  2.49424844e+04,  2.50024277e+04,
                     2.50623672e+04,  2.51223086e+04,  2.51822500e+04,
                     2.52421914e+04,  2.53021309e+04,  2.53620723e+04,
                     2.54220137e+04,  2.54819551e+04,  2.55418945e+04,
                     2.56018379e+04,  2.56617773e+04,  2.57217188e+04,
                     2.57816602e+04,  2.58416016e+04,  2.59015410e+04,
                     2.59614805e+04,  2.60214238e+04,  2.60813633e+04,
                     2.61413047e+04,  2.62012461e+04,  2.62611875e+04,
                     2.63211270e+04,  2.63810684e+04,  2.64410098e+04,
                     2.65009512e+04,  2.65608906e+04,  2.66208340e+04,
                     2.66807734e+04,  2.67407148e+04,  2.68006543e+04,
                     2.68605977e+04,  2.69205371e+04,  2.69804785e+04,
                     2.70404199e+04,  2.71003594e+04,  2.71603008e+04,
                     2.72202402e+04,  2.72801836e+04,  2.73401230e+04,
                     2.74000645e+04,  2.74600059e+04,  2.75199473e+04,
                     2.75798867e+04,  2.76398301e+04,  2.76997695e+04,
                     2.77597109e+04,  2.78196504e+04,  2.78795938e+04,
                     2.79395332e+04,  2.79994746e+04,  2.80594160e+04,
                     2.81193574e+04,  2.81792969e+04,  2.82392363e+04,
                     2.82991797e+04,  2.83591191e+04,  2.84190605e+04,
                     2.84790020e+04,  2.85389434e+04,  2.85988828e+04,
                     2.86588262e+04,  2.87187656e+04,  2.87787070e+04,
                     2.88386465e+04,  2.88985898e+04,  2.89585293e+04,
                     2.90184707e+04,  2.90784121e+04,  2.91383535e+04,
                     2.91982930e+04,  2.92582344e+04,  2.93181758e+04,
                     2.93781172e+04,  2.94380566e+04,  2.94979980e+04,
                     2.95579395e+04,  2.96178789e+04,  2.96778203e+04,
                     2.97377617e+04,  2.97977031e+04,  2.98576426e+04,
                     2.99175859e+04,  2.99775254e+04,  3.00374668e+04,
                     3.00974062e+04,  3.01573496e+04,  3.02172891e+04,
                     3.02772305e+04,  3.03371719e+04,  3.03971133e+04,
                     3.04570527e+04,  3.05169961e+04,  3.05769355e+04,
                     3.06368750e+04,  3.06968164e+04,  3.07567578e+04,
                     3.08166992e+04,  3.08766387e+04,  3.09365820e+04,
                     3.09965215e+04,  3.10564629e+04,  3.11164023e+04,
                     3.11763457e+04,  3.12362852e+04,  3.12962266e+04,
                     3.13561680e+04,  3.14161094e+04,  3.14760488e+04,
                     3.15359902e+04,  3.15959316e+04,  3.16558730e+04,
                     3.17158125e+04,  3.17757539e+04,  3.18356953e+04,
                     3.18956348e+04,  3.19555781e+04,  3.20155176e+04,
                     3.20754590e+04,  3.21353984e+04,  3.21953418e+04,
                     3.22552812e+04,  3.23152227e+04,  3.23751641e+04,
                     3.24351055e+04,  3.24950449e+04,  3.25549863e+04,
                     3.26149277e+04,  3.26748691e+04,  3.27348086e+04,
                     3.27947500e+04,  3.28546914e+04,  3.29146328e+04,
                     3.29745742e+04,  3.30345117e+04,  3.30944570e+04,
                     3.31543945e+04,  3.32143359e+04,  3.32742773e+04,
                     3.33342188e+04,  3.33941602e+04,  3.34541016e+04,
                     3.35140430e+04,  3.35739805e+04,  3.36339258e+04,
                     3.36938633e+04,  3.37538047e+04,  3.38137461e+04,
                     3.38736875e+04,  3.39336289e+04,  3.39935703e+04,
                     3.40535078e+04,  3.41134531e+04,  3.41733945e+04,
                     3.42333320e+04,  3.42932734e+04,  3.43532148e+04,
                     3.44131562e+04,  3.44730977e+04,  3.45330391e+04,
                     3.45929766e+04,  3.46529219e+04,  3.47128594e+04,
                     3.47728008e+04,  3.48327422e+04,  3.48926836e+04,
                     3.49526250e+04,  3.50125664e+04,  3.50725039e+04,
                     3.51324492e+04,  3.51923906e+04,  3.52523281e+04,
                     3.53122695e+04,  3.53722109e+04,  3.54321523e+04,
                     3.54920938e+04,  3.55520312e+04,  3.56119727e+04,
                     3.56719180e+04,  3.57318555e+04,  3.57917969e+04,
                     3.58517383e+04,  3.59116797e+04,  3.59716211e+04,
                     3.60315625e+04,  3.60915000e+04,  3.61514453e+04,
                     3.62113867e+04,  3.62713242e+04,  3.63312656e+04,
                     3.63912109e+04,  3.64511484e+04,  3.65110898e+04,
                     3.65710273e+04,  3.66309688e+04,  3.66909141e+04,
                     3.67508516e+04,  3.68107930e+04,  3.68707344e+04,
                     3.69306758e+04,  3.69906172e+04,  3.70505586e+04,
                     3.71104961e+04,  3.71704414e+04,  3.72303828e+04,
                     3.72903203e+04,  3.73502617e+04,  3.74102070e+04,
                     3.74701445e+04,  3.75300859e+04,  3.75900234e+04,
                     3.76499688e+04,  3.77099102e+04,  3.77698477e+04,
                     3.78297891e+04,  3.78897305e+04,  3.79496719e+04,
                     3.80096133e+04,  3.80695547e+04,  3.81294922e+04,
                     3.81894375e+04,  3.82493789e+04,  3.83093164e+04,
                     3.83692578e+04,  3.84292031e+04,  3.84891406e+04,
                     3.85490820e+04,  3.86090195e+04,  3.86689648e+04,
                     3.87289062e+04,  3.87888438e+04,  3.88487852e+04,
                     3.89087266e+04,  3.89686680e+04,  3.90286094e+04,
                     3.90885508e+04,  3.91484883e+04,  3.92084336e+04,
                     3.92683750e+04,  3.93283125e+04,  3.93882539e+04,
                     3.94481953e+04,  3.95081367e+04,  3.95680781e+04,
                     3.96280156e+04,  3.96879609e+04,  3.97479023e+04,
                     3.98078398e+04,  3.98677812e+04,  3.99277266e+04,
                     3.99876641e+04,  4.00476055e+04,  4.01075469e+04,
                     4.01674844e+04,  4.02274297e+04,  4.02873711e+04],
              mask=False,
        fill_value=1e+20,
             dtype=float32)}
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>radar.range[&#39;data&#39;] = radar.range[&#39;data&#39;] + (59.94095*2)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>radar.init_gate_altitude()
radar.init_gate_longitude_latitude()
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>radar.range[&#39;data&#39;][0:4]
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>masked_array(data=[  7.0511017,  66.99205  , 126.933    , 186.87395  ],
             mask=False,
       fill_value=1e+20,
            dtype=float32)
</pre></div>
</div>
</div>
</div>
</section>
<section id="calculate-pbb-and-cbb">
<h2>Calculate PBB and CBB<a class="headerlink" href="#calculate-pbb-and-cbb" title="Permalink to this headline">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>pbb, cbb = beam_block(radar, tif_file, radar_height_offset=10.0, beam_width=1.0)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/tmp/ipykernel_24697/2466937760.py:51: DeprecationWarning: `np.float` is a deprecated alias for the builtin `float`. To silence this warning, use `float` by itself. Doing this will not modify any behavior and is safe. If you specifically wanted the numpy scalar type, use `np.float64` here.
Deprecated in NumPy 1.20; for more details and guidance: https://numpy.org/devdocs/release/1.20.0-notes.html#deprecations
  sitecoords = (np.float(radar.longitude[&#39;data&#39;]),
/tmp/ipykernel_24697/2466937760.py:52: DeprecationWarning: `np.float` is a deprecated alias for the builtin `float`. To silence this warning, use `float` by itself. Doing this will not modify any behavior and is safe. If you specifically wanted the numpy scalar type, use `np.float64` here.
Deprecated in NumPy 1.20; for more details and guidance: https://numpy.org/devdocs/release/1.20.0-notes.html#deprecations
  np.float(radar.latitude[&#39;data&#39;]),
/tmp/ipykernel_24697/2466937760.py:53: DeprecationWarning: `np.float` is a deprecated alias for the builtin `float`. To silence this warning, use `float` by itself. Doing this will not modify any behavior and is safe. If you specifically wanted the numpy scalar type, use `np.float64` here.
Deprecated in NumPy 1.20; for more details and guidance: https://numpy.org/devdocs/release/1.20.0-notes.html#deprecations
  np.float(radar.altitude[&#39;data&#39;] + radar_height_offset))
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Calculating beam blockage.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/zsherman/anaconda3/envs/pyart_env/lib/python3.8/site-packages/wradlib/qual.py:127: RuntimeWarning: invalid value encountered in sqrt
  numer = (ya * np.sqrt(a**2 - y**2)) + (a * np.arcsin(ya)) + (np.pi * a / 2.0)
/home/zsherman/anaconda3/envs/pyart_env/lib/python3.8/site-packages/wradlib/qual.py:127: RuntimeWarning: invalid value encountered in arcsin
  numer = (ya * np.sqrt(a**2 - y**2)) + (a * np.arcsin(ya)) + (np.pi * a / 2.0)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>pbb_dict = pbb_to_dict(pbb)
cbb_dict = cbb_to_dict(cbb)
radar.add_field(&#39;partial_beam_blockage&#39;, pbb_dict, replace_existing=True)
radar.add_field(&#39;cumulative_beam_blockage&#39;, cbb_dict, replace_existing=True)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>radar.fields[&#39;partial_beam_blockage&#39;][&#39;data&#39;].min()
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.0
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>fig = plt.figure(figsize=(10, 8))
display.plot_ppi(&#39;partial_beam_blockage&#39;, 0, cmap=&#39;pyart_HomeyerRainbow&#39;)
plt.plot(0, 0, marker=&quot;o&quot;, markersize=20, markeredgecolor=&quot;red&quot;, markerfacecolor=&quot;green&quot;)
plt.xlim(-5, 5)
plt.ylim(-5, 5)
plt.savefig(&#39;/home/zsherman/pbb_sail_zoomed.png&#39;)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/sail_beam_blockage_20_0.png" src="../_images/sail_beam_blockage_20_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>pbb[:, 0:5]
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>masked_array(
  data=[[0., 0., 0., 0., 0.],
        [0., 0., 0., 0., 0.],
        [0., 0., 0., 0., 0.],
        ...,
        [0., 0., 0., 0., 0.],
        [0., 0., 0., 0., 0.],
        [0., 0., 0., 0., 0.]],
  mask=False,
  fill_value=1e+20)
</pre></div>
</div>
</div>
</div>
</section>
<section id="see-the-blockage-diminish-as-fixed-angle-increases">
<h2>See the blockage diminish as fixed angle increases<a class="headerlink" href="#see-the-blockage-diminish-as-fixed-angle-increases" title="Permalink to this headline">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>fig = plt.figure(figsize=(10, 8))
display.plot_ppi(&#39;cumulative_beam_blockage&#39;, 2, cmap=&#39;pyart_HomeyerRainbow&#39;)
plt.savefig(&#39;/home/zsherman/cbb.png&#39;)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/sail_beam_blockage_23_0.png" src="../_images/sail_beam_blockage_23_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>def beam_block_flags(cbb_all, complete_block_thresh=0.95):
    &quot;&quot;&quot;
    Takes CBB arrays created from the beam_block function and creates beam block flags.

    Parameters
    ----------
    cbb_all : array
        Array of cumulative beam blockage values created from the beam_block
        function.

    Other Parameters
    ----------------
    complete_block_thresh : float
        Value for the cutoff for complete blockage flag value of 1. Anything
        above the complete_block_thres is considered blocked. Default value
        is 0.95.

    Returns
    -------
    cbb_flags : array
        Array of integer values depicting no, partial, and complete beam
        blockage based on the cumulative beam blockage data. This array can
        then be used to create a cumulative beam block flags field.
    &quot;&quot;&quot;
    cbb_flags = np.ones(cbb_all.shape)
    cbb_flags[cbb_all &lt; complete_block_thresh] = 0
    return cbb_flags
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>cbb_flags = beam_block_flags(cbb, complete_block_thresh=0.80)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>cbb_flag_dict = cbb_flags_to_dict(cbb_flags)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>radar.add_field(&#39;cbb_flag&#39;, cbb_flag_dict, replace_existing=True)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>fig = plt.figure(figsize=(10, 8))
display.plot_ppi(&#39;cbb_flag&#39;, 2, cmap=&#39;pyart_HomeyerRainbow&#39;)
plt.savefig(&#39;/home/zsherman/cbb_flag.png&#39;)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/sail_beam_blockage_28_0.png" src="../_images/sail_beam_blockage_28_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>fields = []
for field in radar.fields.keys():
    fields.append(field)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>fields
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;DBZ&#39;,
 &#39;VEL&#39;,
 &#39;WIDTH&#39;,
 &#39;ZDR&#39;,
 &#39;PHIDP&#39;,
 &#39;RHOHV&#39;,
 &#39;NCP&#39;,
 &#39;SNR&#39;,
 &#39;DBZhv&#39;,
 &#39;partial_beam_blockage&#39;,
 &#39;cumulative_beam_blockage&#39;,
 &#39;cbb_flag&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>for field in fields:
    if field == &#39;cbb_flag&#39;:
        continue
    elif field == &#39;cumulative_beam_blockage&#39;:
        continue
    else:
        radar.fields.pop(field)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>radar.fields.keys()
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>dict_keys([&#39;cumulative_beam_blockage&#39;, &#39;cbb_flag&#39;])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>pyart.io.write_cfradial(&#39;/home/zsherman/flag_radar.nc&#39;, radar)
</pre></div>
</div>
</div>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./qc"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="../gluing_and_inventory/sail_inventory.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">&lt;no title&gt;</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="../dual-pol/dual-pol-exploration.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Explore Dual-Pol Data from SAIL</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By ARM Development Team<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>